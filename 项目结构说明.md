# 项目结构说明

## 完整目录树

```
D:\code\graduate\llm\
│
├── 📁 config/                      # 配置模块
│   ├── __init__.py                # 模块导出
│   └── config.py                  # 配置类（API密钥、模型配置）
│
├── 📁 tools/                       # 工具模块  
│   ├── __init__.py                # 模块导出
│   └── data_query.py              # 数据查询工具（核心功能）
│
├── 📁 agents/                      # 代理模块
│   ├── __init__.py                # 模块导出
│   └── llm_agent.py               # LLM代理（对话管理、工具调用）
│
├── 📁 data/                        # 数据目录（预留）
│
├── 📄 main.py                      # ⭐ 主程序入口（命令行交互）
├── 📄 example.py                   # 完整使用示例
├── 📄 quick_start.py               # 快速测试脚本
├── 📄 test.py                      # 原始测试文件
│
├── 📊 束流.csv                     # 数据文件（36,011条记录）
│
├── 📋 requirements.txt             # Python依赖列表
├── 🚫 .gitignore                   # Git忽略配置
│
└── 📖 文档文件/
    ├── README.md                  # 项目说明（主文档）
    ├── 快速开始.md                # 快速开始指南
    ├── USAGE.md                   # 详细使用指南
    ├── ARCHITECTURE.md            # 架构设计文档
    ├── PROJECT_SUMMARY.md         # 项目总结报告
    └── 项目结构说明.md            # 本文档
```

## 文件功能说明

### 核心代码文件

| 文件 | 代码量 | 功能说明 |
|------|--------|----------|
| `config/config.py` | ~50行 | API配置、系统参数 |
| `tools/data_query.py` | ~185行 | 数据查询、工具定义 |
| `agents/llm_agent.py` | ~259行 | LLM交互、对话管理 |
| `main.py` | ~125行 | 命令行界面 |
| `example.py` | ~116行 | 使用示例 |
| `quick_start.py` | ~76行 | 功能测试 |

**总计**：约 800 行核心代码

### 文档文件

| 文件 | 用途 |
|------|------|
| `README.md` | 项目概述、功能介绍、安装使用 |
| `快速开始.md` | 快速上手指南（中文） |
| `USAGE.md` | 详细使用说明、API参考 |
| `ARCHITECTURE.md` | 架构设计、技术实现 |
| `PROJECT_SUMMARY.md` | 项目总结、成果展示 |
| `项目结构说明.md` | 文件结构说明（本文档） |

**总计**：约 3000 行文档

## 模块依赖关系

```
main.py
  ↓ 导入
agents/
  ├─→ agents/llm_agent.py
  │     ↓ 导入
  │   tools/data_query.py (TOOLS, TOOL_FUNCTIONS)
  │     ↓ 使用
  │   Pandas, OpenAI SDK
  │
  └─→ config/config.py
        ↓ 配置
      API_KEY, BASE_URL, MODEL_NAME
```

## 数据流向

```
用户输入
  ↓
main.py (接收)
  ↓
agents/llm_agent.py (处理)
  ↓
OpenAI SDK → ModelScope API → Qwen3 模型
  ↓
返回工具调用请求
  ↓
tools/data_query.py (执行查询)
  ↓
Pandas → 束流.csv
  ↓
返回数据
  ↓
agents/llm_agent.py (生成回复)
  ↓
main.py (显示)
  ↓
用户看到结果
```

## 关键文件详解

### 1. config/config.py

**职责**：系统配置管理

**核心内容**：
```python
class Config:
    API_KEY = "..."              # ModelScope API密钥
    BASE_URL = "..."             # API地址
    MODEL_NAME = "..."           # 模型名称
    DATA_FILE = "束流.csv"      # 数据文件路径
```

**使用方式**：
```python
from config import Config
config = Config.get_api_config()
```

### 2. tools/data_query.py

**职责**：数据查询工具

**核心组件**：
- `DataQueryTool` 类：数据查询功能
- `query_beam_data()` 函数：时间范围查询
- `get_data_info()` 函数：数据概要查询
- `TOOLS` 列表：工具定义（供LLM使用）
- `TOOL_FUNCTIONS` 字典：函数映射表

**工具数量**：2个
1. `query_beam_data` - 查询束流数据
2. `get_data_info` - 获取数据信息

### 3. agents/llm_agent.py

**职责**：LLM代理和对话管理

**核心类**：
- `BeamDataAgent`：标准版代理
  - `chat()` - 处理对话
  - `_call_llm()` - 调用LLM
  - `_execute_tool_call()` - 执行工具
  
- `StreamingBeamDataAgent`：流式输出版（继承）
  - `chat_stream()` - 流式处理

**特点**：
- 支持多轮对话
- 自动工具调用
- 对话历史管理

### 4. main.py

**职责**：用户交互界面

**核心功能**：
- 欢迎界面和帮助信息
- 命令处理（exit, reset, help）
- 对话循环
- 错误处理

**运行方式**：
```bash
python main.py          # 标准模式
python main.py --stream # 流式模式
```

### 5. 束流.csv

**数据格式**：
```
时间,target,feature1,feature2,...,feature35
2025-08-30T17:23:26,0.3039,0.7346,...
```

**数据规模**：
- 记录数：36,011 条
- 时间跨度：约 10 小时
- 列数：37 列（时间 + target + 35个feature）

## 可扩展点

### 1. 添加新工具
文件：`tools/data_query.py`

```python
# 1. 定义函数
def new_tool():
    pass

# 2. 添加工具描述
TOOLS.append({...})

# 3. 注册函数
TOOL_FUNCTIONS["new_tool"] = new_tool
```

### 2. 修改系统提示
文件：`agents/llm_agent.py`

```python
self.system_prompt = """
你是束流数据分析助手...
[在这里修改系统提示]
"""
```

### 3. 更换模型
文件：`config/config.py`

```python
MODEL_NAME = '你的模型名称'
```

### 4. 集成Web界面
新建文件：`app.py`

```python
from flask import Flask
from agents import BeamDataAgent

app = Flask(__name__)
# ... 实现Web API
```

## 开发建议

### 本地开发
1. 克隆项目
2. 安装依赖：`pip install -r requirements.txt`
3. 运行测试：`python quick_start.py`
4. 开始开发

### 添加新功能
1. 在对应模块中添加代码
2. 更新 `__init__.py` 导出
3. 编写测试
4. 更新文档

### 提交代码
1. 确保测试通过
2. 更新相关文档
3. 提交到版本控制

## 部署建议

### 开发环境
```bash
python main.py
```

### 生产环境
1. 使用虚拟环境
2. 配置环境变量
3. 使用进程管理器（如 supervisor）
4. 添加日志系统

### Docker部署
```dockerfile
FROM python:3.9
WORKDIR /app
COPY . .
RUN pip install -r requirements.txt
CMD ["python", "main.py"]
```

## 维护指南

### 日常维护
- 定期更新依赖包
- 检查API密钥有效性
- 备份数据文件
- 查看错误日志

### 问题排查
1. 查看控制台输出
2. 检查数据文件是否存在
3. 验证API配置
4. 测试网络连接

### 性能优化
- 使用数据库替代CSV
- 实现查询结果缓存
- 限制对话历史长度
- 优化数据加载

## 版本历史

### v1.0 (2025-11-10)
- ✅ 实现基础查询功能
- ✅ 支持自然语言交互
- ✅ 完整的项目文档

### 未来版本
- v1.1: 添加更多分析工具
- v1.2: 集成机器学习模型
- v2.0: Web可视化界面

---

**更新时间**：2025年11月10日  
**项目状态**：✅ 已完成并可用

